<style>
    /* ------------------------------------------- */
    /* 1. ESTILOS GERAIS */
    /* ------------------------------------------- */
    .proposta-container {
        display: flex;
        justify-content: space-between;
        gap: 40px;
        flex-wrap: wrap; /* Permite quebrar em telas menores */
    }
    .item-desejado-card, .item-oferecido-form {
        flex: 1 1 45%; /* Flex√≠vel, ocupa 45% do espa√ßo */
        min-width: 300px; /* Garante que n√£o fiquem muito pequenos */
    }
    .item-desejado-card {
        border: 1px solid #007bff;
        padding: 20px;
        border-radius: 8px;
    }
    .item-oferecido-form {
        background-color: #f9f9f9;
        padding: 20px;
        border-radius: 8px;
        border: 1px solid #ddd;
    }
    .item-info ul {
        list-style: none;
        padding: 0;
    }
    .item-info li {
        margin: 5px 0;
        font-size: 0.95em;
    }

    /* ------------------------------------------- */
    /* 2. ESTILOS DO NOVO SELETOR DE CARDS (OFERTA) */
    /* ------------------------------------------- */
    .lista-de-pecas-oferecer {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 15px;
        margin-top: 15px;
    }

    .item-card-oferta {
        display: block; 
        cursor: pointer;
        border: 2px solid #ccc;
        border-radius: 8px;
        transition: all 0.2s;
        text-align: center;
        padding: 0; /* Removido padding interno para controle visual total */
        background-color: white;
    }

    .item-card-oferta:hover {
        border-color: #9370DB; /* Cor roxa para feedback visual */
        box-shadow: 0 0 5px rgba(147, 112, 219, 0.5);
    }
    
    .card-conteudo {
        padding: 10px; /* Padding aplicado ao conte√∫do */
    }

    .card-imagem {
        height: 100px;
        background-color: #f0f0f0;
        margin-bottom: 5px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.8em;
        color: #555;
        border-top-left-radius: 6px;
        border-top-right-radius: 6px;
    }

    .card-conteudo p {
        margin: 0;
        font-size: 0.9em;
    }
    .card-conteudo .condicao {
        font-size: 0.8em;
        color: #6c757d;
        margin-top: 5px;
    }
    .card-conteudo .status-ativo {
        font-weight: bold;
        color: #007bff; /* Garante que o status 'Ativo' seja vis√≠vel */
    }

    /* ESTILO CR√çTICO: Quando o radio button √© marcado, mude o estilo do card */
    input[type="radio"]:checked + .card-conteudo {
        /* Adiciona um fundo azul claro para indicar sele√ß√£o */
        background-color: #e3f2fd; 
        border-radius: 6px;
    }

    input[type="radio"]:checked + .card-conteudo .card-imagem {
        border: 2px solid #28a745; /* Borda verde na imagem ao selecionar */
    }
    
    .botao-selecionar {
        display: none; /* Esconde o texto/bot√£o extra */
    }

    /* Estilo para mensagem de erro/alerta */
    .mensagem-alerta {
        padding: 15px;
        background-color: #fff3cd;
        border: 1px solid #ffc107;
        color: #856404;
        border-radius: 5px;
        margin-top: 15px;
    }
</style>

<h1>Proposta de Troca</h1>

<% if (messages && messages.warning) { %>
    <p style="color: orange; border: 1px solid orange; padding: 10px; background-color: #fff3cd; border-radius: 5px;">
        <%= messages.warning %>
    </p>
<% } %>

<p>Voc√™ est√° prestes a enviar uma proposta de troca para <%= itemDesejado.usuario.nome %>.</p>
<hr>

<div class="proposta-container">

    <section class="item-desejado-card">
        <h2>Item que voc√™ quer receber:</h2>

        <div style="margin-bottom: 15px; background-color: #eee; text-align: center; padding: 10px; border-radius: 5px;">
            <% if (itemDesejado.imagem_url || itemDesejado.fotoUrl) { %>
                <img src="<%= itemDesejado.imagem_url || itemDesejado.fotoUrl %>" alt="<%= itemDesejado.peca %>" style="max-width: 100%; height: auto; max-height: 200px; display: block; margin: 0 auto;">
            <% } else { %>
                [IMAGEM indispon√≠vel para <%= itemDesejado.peca %>]
            <% } %>
        </div>
        
        <div class="item-info">
            <ul style="list-style: none; padding: 0;">
                <li>Pe√ßa: <strong><%= itemDesejado.peca %></strong></li>
                <hr>
                <li>G√™nero: <strong><%= itemDesejado.tipo %></strong></li> 
                <hr>
                <li>Tamanho: <strong><%= itemDesejado.tamanho %></strong></li>
                <hr>
                <li>Condi√ß√£o: <strong><%= itemDesejado.condicao %></strong></li>
                <hr>
                <li>Cor: <strong><%= itemDesejado.cor || 'N√£o especificada' %></strong></li>
                <hr>
                <li>Dono: <strong><%= itemDesejado.usuario.nome %></strong></li>
                <hr>
                <li>Descri√ß√£o: <strong><%= itemDesejado.descricao || 'Nenhuma descri√ß√£o detalhada.' %></strong></li>
            </ul>
        </div>
    </section>

    <section class="item-oferecido-form">
        <h2>Pe√ßa que voc√™ oferece:</h2>
        
        <form action="/trocas/propor" method="POST">
            
            <input type="hidden" name="itemIdDesejado" value="<%= itemDesejado.id %>">
            
            <% 
                // üí° FILTRAGEM CR√çTICA: Assume que a lista de itens √© 'meusItens' e o status de dispon√≠vel √© 'Ativo'
                const itensDoUsuario = typeof meusItens !== 'undefined' ? meusItens : [];
                const roupasDisponiveis = itensDoUsuario.filter(item => item.statusPosse === 'Ativo');
            %>

            <% if (roupasDisponiveis && roupasDisponiveis.length > 0) { %>
                
                <p>Escolha um item da sua lista para oferecer em troca:</p>

                <div class="lista-de-pecas-oferecer">
                    <% roupasDisponiveis.forEach(function(item) { %>
                        
                        <label class="item-card-oferta" for="peca-<%= item.id %>">
                            
                            <input 
                                type="radio" 
                                name="itemOferecido" 
                                id="peca-<%= item.id %>" 
                                value="<%= item.id %>" 
                                required 
                                style="display: none;" 
                            >
                            
                            <div class="card-conteudo">
                                <div class="card-imagem">
                                    [Foto de <%= item.peca.substring(0, 10) %>...]
                                </div>
                                
                                <p><strong><%= item.peca %></strong></p>
                                <p>Tam: <%= item.tamanho %></p>
                                <p class="condicao"><%= item.condicao %></p>
                            </div>
                        </label>

                    <% }); %>
                </div>


                <button 
                    type="submit" 
                    class="btn-enviar-proposta"
                    style="
                        padding: 10px 20px; 
                        background-color: #9370DB; 
                        color: white; 
                        border: none; 
                        cursor: pointer;
                        margin-top: 20px;
                        width: 100%;
                        font-weight: bold;
                    "
                >
                    ENVIAR PROPOSTA DE TROCA
                </button>

            <% } else { %>
                <div class="mensagem-alerta">
                    <p>Voc√™ n√£o possui itens **DISPON√çVEIS** para oferecer em troca.</p>
                    <p>Cadastre uma pe√ßa ou verifique o status das suas pe√ßas em <a href="/roupas">Gerenciamento</a>.</p>
                </div>
                <a href="/roupas" style="display: inline-block; padding: 10px; background-color: #ffc107; color: #333; text-decoration: none; border-radius: 4px;">
                    Cadastrar Minha Primeira Pe√ßa
                </a>
            <% } %>

        </form>
    </section>

</div>

<p style="margin-top: 30px;">
    <a href="/feed">Voltar ao feed</a>
</p>