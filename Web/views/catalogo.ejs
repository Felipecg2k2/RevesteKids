<div style="display: flex; gap: 20px">
  <div class="filters-column" style="width: 25%">
    <h2>Filtros</h2>
    <div>
      <p>Gênero:</p>
      <input type="checkbox" id="feminino" name="genero" value="Feminino" />
      <label for="feminino">Feminino</label><br />
    </div>
  </div>

  <div
    id="swipe-container"
    style="
      flex-grow: 1;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 80vh;
      padding-top: 20px;
    "
  >
    <% if (itens.length === 0) { %>
    <p style="width: 100%; text-align: center">
      Parece que não há novas peças no catálogo por enquanto!
    </p>
    <% } %> <% itens.forEach((item, index) => { %>
    <div
      class="card-item"
      data-id="<%= item.id %>"
      data-index="<%= index %>"
      style="
        /* Estilos para empilhar as cartas */
        position: absolute;
        width: 90%;
        max-width: 400px;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        background-color: white;
        /* Oculta todas as cartas, exceto a primeira, inicialmente pelo JavaScript */
        display: none;
      "
    >
      <h2><%= item.peca %></h2>
      <img
        src="/uploads/<%= item.imagemURL %>"
        alt="<%= item.peca %>"
        style="
          max-width: 100%;
          height: auto;
          border-radius: 4px;
          margin-bottom: 10px;
        "
      />

      <p>
        <strong>Dono:</strong> <%= item.usuario.nome %> (<%= item.usuario.cidade
        %> / <%= item.usuario.estado %>)
      </p>
      <p><strong>Gênero:</strong> <%= item.genero %></p>
      <p><strong>Tamanho:</strong> <%= item.tamanho %></p>
      <p><strong>Condição:</strong> <%= item.condicao %></p>

      <div
        class="card-actions"
        style="
          display: flex;
          justify-content: space-between;
          margin-top: 20px;
          align-items: center;
        "
      >
        <button
          class="btn-voltar"
          data-item-id="<%= item.id %>"
          style="
            padding: 10px 15px;
            background-color: #ffc107; /* Amarelo/Aviso */
            color: black;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
          "
        >
          Voltar (↩️)
        </button>

        <button
          class="btn-ignorar"
          data-item-id="<%= item.id %>"
          style="
            padding: 10px 20px;
            background-color: #f44336;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
          "
        >
          Ignorar (❌)
        </button>

        <a
          href="/trocas/propor/<%= item.id %>"
          class="btn-trocar"
          style="
            padding: 10px 20px;
            background-color: #4caf50;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            text-align: center;
            font-size: 16px;
          "
        >
          Propor Troca (✅)
        </a>
      </div>
    </div>
    <% }); %>
  </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const cardContainer = document.getElementById('swipe-container');
        const cards = document.querySelectorAll('.card-item');
        let currentIndex = 0; // Começa na primeira carta

        // Função para mostrar apenas a carta atual
        function updateCardDisplay() {
            cards.forEach((card, index) => {
                // Oculta todas as cartas
                card.style.display = 'none';
                
                // Exibe apenas a carta atual
                if (index === currentIndex) {
                    card.style.display = 'block';
                }
            });

            // Se o índice atual for igual ao número de cartas, o catálogo acabou
            if (currentIndex >= cards.length) {
                cardContainer.innerHTML = '<p style="width: 100%; text-align: center;">Você viu todas as peças do catálogo! Volte mais tarde.</p>';
            }
            
            // Oculta/Exibe o botão de voltar quando estiver na primeira carta
            const btnVoltar = document.querySelector('.btn-voltar');
            if (btnVoltar) {
                 // Busca o botão "Voltar" da carta atual
                const currentCardBtnVoltar = cards[currentIndex] ? cards[currentIndex].querySelector('.btn-voltar') : null;

                // Oculta o botão Voltar APENAS na primeira carta (índice 0)
                if (currentCardBtnVoltar) {
                    currentCardBtnVoltar.style.display = currentIndex === 0 ? 'none' : 'inline-block';
                }
            }
        }

        // 1. Lógica para Ignorar: avança o índice
        document.querySelectorAll('.btn-ignorar').forEach(button => {
            button.addEventListener('click', () => {
                currentIndex++;
                updateCardDisplay();
            });
        });

        // 2. Lógica para Voltar (NOVA): recua o índice
        document.querySelectorAll('.btn-voltar').forEach(button => {
            button.addEventListener('click', () => {
                if (currentIndex > 0) {
                    currentIndex--;
                    updateCardDisplay();
                }
            });
        });


        // Inicializa a exibição (apenas a primeira carta visível)
        if (cards.length > 0) {
            updateCardDisplay(); 
        }
    });
</script>