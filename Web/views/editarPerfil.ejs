<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editar Meu Perfil - Reveste Kids</title>

    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/perfil.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>

<body>

    <div class="app-layout">
        <%- include('partials/_sidebar') %>

        <main class="content-area">
            <div class="content-area-pad">

                <div class="perfil-container form-container">
                    <h1>Editar Meu Perfil</h1>

                    <form method="POST" action="/perfil/salvar" class="edit-form" enctype="multipart/form-data">

                                                <div class="form-section">
                            <h2>Foto de Perfil</h2>

                            <div class="form-group full-width" style="text-align: center;">
                                <% 
                                    const fotoPath = (usuario.foto_perfil && usuario.foto_perfil !== 'default-user.png') 
                                      ? `/uploads/perfis/${usuario.foto_perfil}` 
                                      : '/img/default-user.png'; 
                                %>
                                <img src="<%= fotoPath %>" alt="Foto Atual" class="foto-perfil-img" id="preview">
                                
                                <input type="file" name="foto_perfil_update" id="foto" accept="image/*" style="margin-top: 10px;">
                                
                                <div style="margin-top: 10px;">
                                    <input type="checkbox" id="remover_foto" name="remover_foto">
                                    <label for="remover_foto" style="margin-left: 5px;">Remover foto atual (Usar padrão)</label>
                                </div>
                            </div>
                        </div>

                                                <div class="form-section">
                            <h2>Informações Pessoais</h2>
                            
                            <div class="form-group">
                                <div>
                                    <label for="nome">Nome:</label>
                                    <input type="text" id="nome" name="nome" value="<%= usuario.nome %>" required>
                                </div>
                                <div>
                                    <label for="sobrenome">Sobrenome:</label>
                                    <input type="text" id="sobrenome" name="sobrenome" value="<%= usuario.sobrenome %>" required>
                                </div>
                            </div>

                                                        <div class="form-group full-width">
                                <label for="email">E-mail:</label>
                                <input type="email" id="email" name="email" value="<%= usuario.email %>" required>
                            </div>
                        </div>

                                                <div class="form-section">
                            <h2>Endereço</h2>
                            
                                                        <div class="form-group">
                                <div>
                                    <label for="cep">CEP:</label>
                                    <input type="text" id="cep" name="cep" value="<%= usuario.cep %>" required>
                                </div>
                                <div>
                                    <label for="numero">Número:</label>
                                    <input type="text" id="numero" name="numero" value="<%= usuario.numero %>" required>
                                </div>
                            </div>
                            
                                                        <div class="form-group full-width">
                                <label for="logradouro">Logradouro:</label>
                                <input type="text" id="logradouro" name="logradouro" value="<%= usuario.logradouro %>" required>
                            </div>
                            
                                                        <div class="form-group full-width">
                                <label for="bairro">Bairro:</label>
                                <input type="text" id="bairro" name="bairro" value="<%= usuario.bairro %>" required>
                            </div>
                            
                                                        <div class="form-group">
                                <div>
                                    <label for="cidade">Cidade:</label>
                                    <input type="text" id="cidade" name="cidade" value="<%= usuario.cidade %>" required>
                                </div>
                                <div>
                                    <label for="estado">Estado (UF):</label>
                                    <input type="text" id="estado" name="estado" value="<%= usuario.estado %>" required>
                                </div>
                            </div>
                        </div>

                        <div class="form-actions">
                            <a href="/perfil" class="btn-cancelar">Cancelar e Voltar</a>
                            <button type="submit" class="btn-submit">
                                <i class="fas fa-save"></i> Atualizar Perfil
                            </button>
                        </div>
                    </form>

                    <div class="acoes">
                        <h2>Opções da Conta</h2>
                        <form method="POST" action="/perfil/apagar" style="display: inline-block;">
                            <button type="submit" class="link-apagar-conta" style="background:none; border:none; cursor:pointer;"
                                onclick="return confirm('Tem certeza que deseja apagar permanentemente o seu perfil? Esta ação não pode ser desfeita.');">
                            <i class="fas fa-trash-alt"></i> Apagar minha conta
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // pré-visualização da nova imagem
        document.getElementById('foto').addEventListener('change', function (event) {
            const preview = document.getElementById('preview');
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = e => preview.src = e.target.result;
                reader.readAsDataURL(file);
            }
        });
    </script>
</body>
</html>