<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title><%= title %></title>
    
    <link rel="stylesheet" href="/css/feed.css">
    
    <link rel="stylesheet" href="/css/sidebar.css">
    
    </head>
<body>
    
    <div class="app-layout">
        
        <%- include('partials/_sidebar') %>
        
        <div class="content-area">
            
            

            <div class="feed-content-and-filters">
                
                <div class="filters-column">
                    <h2>Filtros</h2>
                    
                    <div class="filter-group">
                        <p>Gênero</p>
                        <input type="checkbox" id="feminino" name="genero" value="Feminino" />
                        <label for="feminino">Feminino</label><br />
                        <input type="checkbox" id="masculino" name="genero" value="Masculino" />
                        <label for="masculino">Masculino</label><br />
                        <input type="checkbox" id="unissex" name="genero" value="Unissex" />
                        <label for="unissex">Unissex</label><br />
                    </div>

                    <div class="filter-group">
                        <p>Tamanho</p>
                        <div class="button-group">
                            <button class="filter-button" data-filter-type="tamanho" data-value="0-3">0-3</button>
                            <button class="filter-button" data-filter-type="tamanho" data-value="3-6">3-6</button>
                            <button class="filter-button" data-filter-type="tamanho" data-value="6+">6+</button>
                            <button class="filter-button" data-filter-type="tamanho" data-value="1-2">1-2</button>
                            <button class="filter-button" data-filter-type="tamanho" data-value="2-3">2-3</button>
                            <button class="filter-button" data-filter-type="tamanho" data-value="3-4">3-4</button>
                        </div>
                    </div>

                    <div class="filter-group">
                        <p>Tipo de Peça</p>
                        <div class="button-group">
                            <button class="filter-button" data-filter-type="peca" data-value="Camiseta">Camiseta</button>
                            <button class="filter-button" data-filter-type="peca" data-value="Calça">Calça</button>
                            <button class="filter-button" data-filter-type="peca" data-value="Vestido">Vestido</button>
                            <button class="filter-button" data-filter-type="peca" data-value="Suéter">Suéter</button>
                            <button class="filter-button" data-filter-type="peca" data-value="Tênis">Tênis</button>
                            <button class="filter-button" data-filter-type="peca" data-value="Shorts">Shorts</button>
                        </div>
                    </div>

                </div>

                <div id="swipe-container">
                    
                    <% if (pecasDisponiveis.length === 0) { %>
                    <p style="width: 100%; text-align: center">
                        Parece que não há novas peças no catálogo por enquanto!
                    </p>
                    <% } %> 
                    
                    <% pecasDisponiveis.forEach((item, index) => { %>
                    <div
                        class="card-item"
                        data-id="<%= item.id %>"
                        data-index="<%= index %>"
                    >
                        <h2><%= item.peca %></h2>
                        <div style="height: 250px; background-color: #f0f0f0; display: flex; justify-content: center; align-items: center; border-radius: 8px;">
                            [IMAGEM AQUI - <%= item.peca %>]
                        </div>

                        <p>
                            <strong>Dono:</strong> <%= item.usuario.nome %> 
                            </p>
                        <p><strong>Gênero:</strong> <%= item.genero %></p>
                        <p><strong>Tamanho:</strong> <%= item.tamanho %></p>
                        <p><strong>Condição:</strong> <%= item.condicao %></p>

                        <div class="card-actions">
                            <button
                                class="btn-voltar"
                                data-item-id="<%= item.id %>"
                                style="display: none;" 
                            >
                                Voltar (↩️)
                            </button>

                            <button
                                class="btn-ignorar"
                                data-item-id="<%= item.id %>"
                            >
                                Ignorar (❌)
                            </button>

                            <a
                                href="/trocas/propor/<%= item.id %>"
                                class="btn-trocar"
                                class="btn-trocar"
                            >
                                Propor Troca (✅)
                            </a>
                        </div>
                    </div>
                    <% }); %>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const cardContainer = document.getElementById('swipe-container');
            const cards = document.querySelectorAll('.card-item'); 
            let currentIndex = 0; 

            // Função para mostrar apenas a carta atual e ajustar o botão 'Voltar'
            function updateCardDisplay() {
                cards.forEach((card, index) => {
                    card.style.display = 'none';
                    
                    if (index === currentIndex) {
                        card.style.display = 'block';
                        
                        // Ajuste do botão Voltar na carta atual
                        const currentCardBtnVoltar = card.querySelector('.btn-voltar');
                        if (currentCardBtnVoltar) {
                            currentCardBtnVoltar.style.display = currentIndex === 0 ? 'none' : 'inline-block';
                        }
                    }
                });

                // Fim do Catálogo
                if (currentIndex >= cards.length) {
                    cardContainer.innerHTML = '<p style="width: 100%; text-align: center; padding: 50px;">Você viu todas as peças do catálogo! Volte mais tarde.</p>';
                }
            }

            // 1. Lógica para Avançar: Ignorar ou Trocar (avança o índice)
            function setupActionButtons() {
                // Seleciona todos os botões 'Ignorar' e links 'Propor Troca'
                document.querySelectorAll('.btn-ignorar, .btn-trocar').forEach(button => {
                    // Previne a adição de múltiplos listeners se a função for chamada novamente
                    button.removeEventListener('click', handleNextCard); 
                    button.addEventListener('click', handleNextCard);
                });

                // Seleciona todos os botões 'Voltar'
                document.querySelectorAll('.btn-voltar').forEach(button => {
                    button.removeEventListener('click', handlePrevCard);
                    button.addEventListener('click', handlePrevCard);
                });

                // NOVO: Adiciona a lógica de clique para os botões de filtro
                document.querySelectorAll('.filter-button').forEach(button => {
                    button.addEventListener('click', toggleFilter);
                });
            }
            
            // Handler para Avançar
            function handleNextCard(event) {
                if (event.currentTarget.classList.contains('btn-ignorar')) {
                     // Aqui você pode adicionar uma chamada AJAX para registrar a ação de ignorar, se desejar.
                }
                
                currentIndex++;
                updateCardDisplay();
            }
            
            // Handler para Voltar
            function handlePrevCard(event) {
                if (currentIndex > 0) {
                    currentIndex--;
                    updateCardDisplay();
                    // Aqui você pode adicionar uma chamada AJAX para registrar o "desfazer" de ignorar, se desejar.
                }
            }

            // NOVO: Lógica de clique para os botões de filtro (simples toggle visual)
            function toggleFilter(event) {
                const button = event.currentTarget;
                // Alterna a classe 'active' para indicar se o filtro está selecionado
                button.classList.toggle('active');

                // Em uma aplicação real, você faria uma chamada AJAX/fetch aqui 
                // para recarregar o catálogo com base nos filtros selecionados.
                
                // Exemplo de como pegar todos os filtros selecionados:
                // const selectedFilters = {
                //     tamanho: Array.from(document.querySelectorAll('.filter-button[data-filter-type="tamanho"].active')).map(btn => btn.dataset.value),
                //     peca: Array.from(document.querySelectorAll('.filter-button[data-filter-type="peca"].active')).map(btn => btn.dataset.value),
                //     genero: Array.from(document.querySelectorAll('input[name="genero"]:checked')).map(input => input.value)
                // };
                // console.log("Filtros selecionados:", selectedFilters);
            }

            // Inicializa a exibição e os listeners
            if (cards.length > 0) {
                updateCardDisplay(); 
                setupActionButtons(); // Adiciona os listeners
            }
            
            // NOVO: Adiciona listener para checkboxes de Gênero, apenas para fins de estado/feedback visual
            document.querySelectorAll('input[name="genero"]').forEach(checkbox => {
                checkbox.addEventListener('change', () => {
                    // Em uma aplicação real, você faria uma chamada AJAX/fetch aqui
                    // para recarregar o catálogo com base nos filtros selecionados.
                    // console.log("Filtro de Gênero alterado");
                });
            });

        });
    </script>
</body>
</html>