<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configurações</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="/css/configuracoes.css">
</head>
<body>
    
    <div id="app-container">
        <%- include('partials/_sidebar') %> 

        <main id="main-content">
            <section class="config-block personal-block">
                <div class="block-header"><i class="fas fa-user-cog"></i><h3>Pessoal</h3></div>
                <ul>
                    <%- include('partials/config_item', { icon: 'fa-user', title: 'Perfil', description: 'Editar informações pessoais', action_link: '/perfil/editar', action_label: 'Editar' }) %>
                    <%- include('partials/config_item', { icon: 'fa-share-alt', title: 'Compartilhamento', description: 'Gerenciar como suas informações são compartilhadas', action_link: '/configuracoes/compartilhamento', action_label: 'Configurar' }) %>
                    <%- include('partials/config_item', { icon: 'fa-sync-alt', title: 'Trocas', description: 'Histórico e preferências de trocas', action_link: '/status-trocas', action_label: 'Ver' }) %>
                </ul>
            </section>
            
            <section class="config-block navigation-block">
                <div class="block-header"><i class="fas fa-route"></i><h3>Navegação</h3></div>
                <ul>
                    <%- include('partials/config_item', { icon: 'fa-comment-dots', title: 'Chat', description: 'Configurações de mensagens e notificações', action_link: '/configuracoes/chat', action_label: 'Configurar' }) %>
                    <%- include('partials/config_item', { icon: 'fa-user-lock', title: 'Contas Bloqueadas', description: 'Gerenciar usuários bloqueados', action_link: '/configuracoes/bloqueados', action_label: 'Ver Lista' }) %>
                </ul>
            </section>

            <section class="config-block personalization-block">
                <div class="block-header"><i class="fas fa-palette"></i><h3>Personalização</h3></div>
                <ul>
                    <%- include('partials/config_item', { icon: 'fa-filter', title: 'Palavras Ocultas', description: 'Filtrar conteúdo com palavras específicas', action_link: '/configuracoes/palavras-ocultas', action_label: 'Configurar' }) %>
                    <%- include('partials/config_item', { icon: 'fa-file-alt', title: 'Reporte', description: 'Reportar problemas ou usuários inadequados', action_link: '/reportar', action_label: 'Reportar' }) %>
                    <%- include('partials/config_item', { icon: 'fa-cogs', title: 'Gerenciamento', description: 'Configurações gerais da conta', action_link: '/configuracoes/gerenciamento', action_label: 'Acessar' }) %>
                    <%- include('partials/config_item', { icon: 'fa-mobile-alt', title: 'Preferências do App', description: 'Personalizar experiência do aplicativo', action_link: '/configuracoes/preferencias-app', action_label: 'Configurar' }) %>
                </ul>
            </section>

            <section class="config-block app-block">
                <div class="block-header"><i class="fas fa-mobile"></i><h3>Aplicativo</h3></div>
                <ul>
                    <%- include('partials/config_item', { icon: 'fa-wrench', title: 'Permissões', description: 'Gerenciar permissões do aplicativo', action_link: '/configuracoes/permissoes', action_label: 'Configurar' }) %>
                    <%- include('partials/config_item', { icon: 'fa-bell', title: 'Notificações Push', description: 'Controlar notificações recebidas', is_switch: true, is_checked: true }) %>
                    <%- include('partials/config_item', { icon: 'fa-download', title: 'Atualizações Automáticas', description: 'Baixar atualizações automaticamente', is_switch: true, is_checked: true }) %>
                </ul>
            </section>
            
            <section class="config-block danger-zone">
                <div class="block-header"><i class="fas fa-exclamation-triangle"></i><h3 class="danger-title">Zona de Perigo</h3></div>
                <ul>
                    <%- include('partials/config_item', { icon: 'fa-sign-out-alt', title: 'Sair da Conta', description: 'Desconectar do ReVeste Kids', action_link: '/logout', action_label: 'Sair', is_danger: true }) %>
                    
                                        <%- include('partials/config_item', { 
                        icon: 'fa-trash-alt', 
                        title: 'Excluir Conta', 
                        description: 'Remover permanentemente sua conta e dados', 
                        action_label: 'Excluir Conta', 
                        is_danger: true,
                        // Adicionamos um ID para o botão/link que acionará o JavaScript
                        action_id: 'btn-excluir-conta'
                    }) %>
                </ul>
            </section>
            
            <form id="form-excluir-conta" method="POST" action="/perfil/apagar" style="display: none;">
                </form>

        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const btnExcluir = document.getElementById('btn-excluir-conta');
            const formExcluir = document.getElementById('form-excluir-conta');

            if (btnExcluir && formExcluir) {
                // A ação de exclusão da conta deve ser feita pelo formulário POST
                // Por isso, substituímos o link simples por um evento de clique
                btnExcluir.addEventListener('click', (e) => {
                    e.preventDefault(); // Impede o link padrão de redirecionar

                    const confirmacao = window.confirm(
                        "ATENÇÃO: Você tem certeza que deseja excluir permanentemente sua conta? Esta ação não pode ser desfeita."
                    );

                    if (confirmacao) {
                        formExcluir.submit(); // Envia o formulário POST
                    }
                });
            }
        });
    </script>
</body>
</html>